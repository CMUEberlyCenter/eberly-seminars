<section class="seminar-group <%= @seminar.status %> admin">
  <h1><%= @seminar.title %></h1>

  <%= render "participant_legend" %>

  <p class="date"><%= raw @seminar.formatted_timespan %></p>

  <p class="description"><%= raw @seminar.description %></p>
  <% if @seminar.status == 'published' %>
  <p style="margin-left: 10px;">
      <strong>Registrations:</strong>
      <%= @seminar.registrations.size %><br/>
      <strong>Pending:</strong>
      <%= @seminar.registrations.pending.size %><br/>
      <strong>Confirmed:</strong>
      <%= @seminar.registrations.confirmed.size %><br/>
      <strong>Capacity:</strong>
      <div style="width: 120px; float: left; margin-top: -8px; clear: both; margin-right: 5px; margin-left: 10px; ">
	<div class="capacity">
	  <%= 
	     content_tag( :div,
             content_tag( :span, '', :style => "width: " + @seminar.capacity_percentage.to_s + "%" ), :class => "capacity-meter" )
	  
	  %>
	</div>
      </div>

      <%= @seminar.capacity_percentage.to_s %>%
  </p>


  <% end %>


  <% unless @seminar.expired? %>
  <p class="manage">
    <%= link_to "Edit", edit_admin_seminar_url(@seminar), :class => 'boxy' %>
    <% if @seminar.status == 'published' %>
      <%= link_to raw('<em>Unpublish</em>'), edit_admin_seminar_url(@seminar), :class => 'boxy' %>
    
    <% else %>
      <%= link_to 'Publish', edit_admin_seminar_url(@seminar), :class => 'boxy' %>
    <% end %>
    
    <%= link_to "Sign-In Sheet [pdf]", 
	admin_seminar_url(@seminar, :format => 'pdf', :profile => 'sign-in'), :class => 'boxy' %>
  </p>
  <% end %>
  
  <ul class="connected-sortable participants-list" id="registered-participants">
    <li class="cant-drag" id="add-participant"><%= link_to( image_tag( "face.png") + "+ Add Participant", new_admin_seminar_registration_path(@seminar), :remote => true ) %></li>
    <%= form_for [@seminar, @seminar.registrations.build], :url=> admin_seminar_path(@seminar), :html => {:class => "dropable", :id => 'registration_form'} do |f| %>
    
    <% @seminar.registrations.confirmed.each do |registration| %>
    <%#= f.fields_for :registrations, registration do |registration_form| %>
    <% css_classes = "participant"

       if registration.participant.student_class == "Masters"
         css_classes = css_classes + " masters"
       elsif registration.participant.student_class == "Doctoral"
         css_classes = css_classes + " phd"
       end
       
       if registration.seminar.expired?
         css_classes = css_classes + " attendance"
       end
    %>
    <%# end %>

    <li id ="ids_<%=registration.id %>" class="<%= h css_classes %>" style="position: relative;">
      <%= link_to( image_tag("face.png") + registration.participant.name, '') %>

      <div class="attendance-form">
	<% AttendanceStatus.all.each do |status| %>
          <%= radio_button_tag( "attendance_status_#{registration.id.to_s}", status.id, registration.attendance_status_id == status.id ) %>
	  <%= label_tag "attendance_status_#{registration.id}_#{status.id}", status.status %>
        <% end %>
        <%= hidden_field_tag 'registration', registration.id %>
      </div>
    </li>
    <% end %>
  </ul>

  <ul class="connected-sortable participants-list" id="waitlisted_participants">

    <% @seminar.registrations.pending.each do |registration| %>
    <%= f.fields_for :registrations, registration do |registration_form| %>
    <% css_classes = "participant"
       if registration.participant.student_class == "Masters"
         css_classes = css_classes + " masters"
       elsif registration.participant.student_class == "Doctoral"
         css_classes = css_classes + " phd"
       end
    %>
    <li id= "ids_<%= registration.id %>" class="<%= h css_classes %>">     
      <%= link_to( image_tag("face.png") + registration.participant.name, '') %>
    </li>
    <% end %>
    <% end %>
  </ul>

  <%# f.submit "Update", :class => 'button' %>
  <% end %>
</section>

<!--
  <script>
    $('#registered-participants form li').sortElements(function(a, b){
    var stuff = new String($(a).text());
    return $(a).text().split(' ')[1] > $(b).text().split(' ')[1] ? 1 : -1;
    });
  </script>
-->
